### –ß—Ç–æ –≤—ã–≤–µ–¥–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∞?
–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–ø—É—Å—Ç–∏—Ç –¥–≤–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ `goroutine`:
1. `read()`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —á–∏—Ç–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `m["a"]` –∏ –≤—ã–≤–æ–¥–∏—Ç –µ–≥–æ.
2. `write()`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç `m["a"] = 2`.

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
- –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –≤ `map` –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ, –Ω–æ `map` –≤ Go **–Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö**.
- –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ **–≥–æ–Ω–∫–µ –¥–∞–Ω–Ω—ã—Ö (data race)**, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å **panic: concurrent map read and map write** –∏–ª–∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é.
- –í–æ–∑–º–æ–∂–µ–Ω –∫—Ä–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

### –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –∫–æ–¥?
#### **1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sync.Mutex`**
–ú–æ–∂–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `map` —Å –ø–æ–º–æ—â—å—é –º—å—é—Ç–µ–∫—Å–∞:

```go
package main

import (
	"fmt"
	"sync"
	"time"
)

var (
	m    = map[string]int{"a": 1}
	lock sync.Mutex
)

func main() {
	go read()
	time.Sleep(1 * time.Second)
	go write()
	time.Sleep(1 * time.Second)
}

func read() {
	for {
		lock.Lock()
		fmt.Println(m["a"])
		lock.Unlock()
	}
}

func write() {
	for {
		lock.Lock()
		m["a"] = 2
		lock.Unlock()
	}
}
```
üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**  
- `lock.Lock()` –ø–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º/–∑–∞–ø–∏—Å—å—é –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `map`.
- `lock.Unlock()` –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –µ–≥–æ.

üîπ **–ü–ª—é—Å—ã**:
- –ò–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

üîπ **–ú–∏–Ω—É—Å—ã**:
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

---

#### **2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sync.RWMutex`**
–ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥, –∏—Å–ø–æ–ª—å–∑—É—è `sync.RWMutex`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç **–º–Ω–æ–≥–∏–º `goroutine` —á–∏—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–π `goroutine` –ø–∏—Å–∞—Ç—å**:

```go
package main

import (
	"fmt"
	"sync"
	"time"
)

var (
	m    = map[string]int{"a": 1}
	lock sync.RWMutex
)

func main() {
	go read()
	time.Sleep(1 * time.Second)
	go write()
	time.Sleep(1 * time.Second)
}

func read() {
	for {
		lock.RLock()
		fmt.Println(m["a"])
		lock.RUnlock()
	}
}

func write() {
	for {
		lock.Lock()
		m["a"] = 2
		lock.Unlock()
	}
}
```
üîπ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
- `lock.RLock()` –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏–º `goroutine` —á–∏—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- `lock.Lock()` –∑–∞–ø—Ä–µ—â–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ `map` –¥–ª—è –≤—Å–µ—Ö, –ø–æ–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å.

---

#### **3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sync.Map` (–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—É—é –∫–∞—Ä—Ç—É)**
Go –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—É—é `sync.Map`, –∫–æ—Ç–æ—Ä–∞—è –ª—É—á—à–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–∞–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:

```go
package main

import (
	"fmt"
	"sync"
	"time"
)

var m sync.Map

func init() {
	m.Store("a", 1)
}

func main() {
	go read()
	time.Sleep(1 * time.Second)
	go write()
	time.Sleep(1 * time.Second)
}

func read() {
	for {
		value, _ := m.Load("a")
		fmt.Println(value)
	}
}

func write() {
	for {
		m.Store("a", 2)
	}
}
```
üîπ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ `sync.Map`**:
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞.
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–µ–µ, –µ—Å–ª–∏ —á–∏—Ç–∞–µ—Ç—Å—è —á–∞—â–µ, —á–µ–º –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è.

---

### –ò—Ç–æ–≥:
| –ú–µ—Ç–æ–¥            | –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
|-----------------|------------------|-----------------|
| `sync.Mutex`     | ‚úÖ –î–∞              | ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–æ      |
| `sync.RWMutex`   | ‚úÖ –î–∞              | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ        |
| `sync.Map`       | ‚úÖ –î–∞              | ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ    |

–ï—Å–ª–∏ –∫–∞—Ä—Ç–∞ —á–∏—Ç–∞–µ—Ç—Å—è —á–∞—â–µ, —á–µ–º –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è ‚Üí `sync.Map` –ª—É—á—à–µ.  
–ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–Ω—ã ‚Üí `sync.RWMutex` –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö–æ—Ä–æ—à–∏–º –≤—ã–±–æ—Ä–æ–º.  
–ï—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ ‚Üí `sync.Mutex`.

**–í—ã–≤–æ–¥:**  
–í–∞—à –∫–æ–¥ –≤ —Ç–µ–∫—É—â–µ–º –≤–∏–¥–µ –≤—ã–∑–æ–≤–µ—Ç `panic`. –õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Äî `sync.Map` –∏–ª–∏ `sync.RWMutex`, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å. üöÄ