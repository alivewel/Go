package main

import (
	"errors"
	"sync"
)

func Search(servers []string, query string) ([]string, error) {
	var wg sync.WaitGroup
	resultChan := make(chan []string, 1) // –ö–∞–Ω–∞–ª –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
	errorChan := make(chan error, len(servers)) // –ö–∞–Ω–∞–ª –¥–ª—è –æ—à–∏–±–æ–∫

	// –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
	for _, server := range servers {
		wg.Add(1)
		go func(server string) {
			defer wg.Done()
			// –í—ã–∑—ã–≤–∞–µ–º —Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∏—Å–∫–∞
			res, err := search.Search(server, query)
			if err != nil {
				errorChan <- err // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É –≤ –∫–∞–Ω–∞–ª
				return
			}
			select {
			case resultChan <- res: // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–∞–Ω–∞–ª
			default:
				// –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –Ω–∞–π–¥–µ–Ω, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
			}
		}(server)
	}

	// –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω
	go func() {
		wg.Wait()
		close(resultChan)
		close(errorChan)
	}()

	// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —É–¥–∞–ª–∏—Å—å
	select {
	case res := <-resultChan:
		return res, nil
	default:
		return nil, errors.New("all servers failed to return a result")
	}
}

–∞ —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ?


-------




–≠—Ç–æ—Ç –∫–æ–¥ **–Ω–µ —Å–æ–≤—Å–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π** –∏ –º–æ–∂–µ—Ç **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö**. –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º –æ—à–∏–±–∫–∏.

---

### ‚ùå **–û—à–∏–±–∫–∞ ‚Ññ1: –û—à–∏–±–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω—ã**
```go
select {
case res := <-resultChan:
    return res, nil
default:
    return nil, errors.New("all servers failed to return a result")
}
```
üî¥ **–ß—Ç–æ –Ω–µ —Ç–∞–∫?**  
- `select` —Å `default` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ**.
- –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä **–µ—â–µ –Ω–µ —É—Å–ø–µ–ª –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `resultChan`**, –∫–æ–¥ **—Å—Ä–∞–∑—É –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É** `"all servers failed to return a result"`, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –µ—â–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è.
- **–†–µ—à–µ–Ω–∏–µ**: –í–º–µ—Å—Ç–æ `default` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä—É—é—â–µ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –≤ `select`.

---

### ‚ùå **–û—à–∏–±–∫–∞ ‚Ññ2: –û—à–∏–±–∫–∏ –∏–∑ `errorChan` –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è**
```go
errorChan := make(chan error, len(servers))
...
errorChan <- err
...
close(errorChan)
```
üî¥ **–ß—Ç–æ –Ω–µ —Ç–∞–∫?**  
- –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `errorChan`, –Ω–æ –≤ –∫–æ–¥–µ –Ω–∏–≥–¥–µ **–Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏—Ö —á—Ç–µ–Ω–∏–µ**.
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ **—É—Ç–µ—á–∫–µ –≥–æ—Ä—É—Ç–∏–Ω**: –µ—Å–ª–∏ –±—É—Ñ–µ—Ä `errorChan` –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è, —Ç–æ –≥–æ—Ä—É—Ç–∏–Ω–∞ **–∑–∞–≤–∏—Å–Ω–µ—Ç** –Ω–∞ `errorChan <- err`.

‚úÖ **–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?**  
- –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `errorChan` –≤ `select`, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫—É.

---

### ‚ùå **–û—à–∏–±–∫–∞ ‚Ññ3: –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –¥–æ —á—Ç–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
```go
go func() {
    wg.Wait()
    close(resultChan)
    close(errorChan)
}()
```
üî¥ **–ß—Ç–æ –Ω–µ —Ç–∞–∫?**  
- `close(resultChan)` –∏ `close(errorChan)` –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ –≥–æ—Ä—É—Ç–∏–Ω–µ**, –Ω–æ `select` —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ.
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **panic**, –µ—Å–ª–∏ –∫–∞–Ω–∞–ª –∑–∞–∫—Ä—ã—Ç, –∞ –º—ã –ø–æ–ø—Ä–æ–±—É–µ–º –∏–∑ –Ω–µ–≥–æ —á–∏—Ç–∞—Ç—å.
- –ó–∞–∫—Ä—ã–≤–∞—Ç—å `errorChan` **–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**, —Ç–∞–∫ –∫–∞–∫ –º—ã —á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫—É.

‚úÖ **–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?**  
- –£–¥–∞–ª–∏—Ç—å `close(errorChan)`, –∞ `resultChan` –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫**.

---

## üèÜ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥**
```go
package main

import (
	"errors"
	"sync"
)

func Search(servers []string, query string) ([]string, error) {
	var wg sync.WaitGroup
	resultChan := make(chan []string, 1) // –ö–∞–Ω–∞–ª –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
	errorChan := make(chan error, len(servers)) // –ö–∞–Ω–∞–ª –¥–ª—è –æ—à–∏–±–æ–∫
	var errorCount int
	var errorMutex sync.Mutex

	// –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
	for _, server := range servers {
		wg.Add(1)
		go func(server string) {
			defer wg.Done()
			res, err := search.Search(server, query)
			if err != nil {
				errorMutex.Lock()
				errorCount++
				errorMutex.Unlock()
				if errorCount == len(servers) {
					errorChan <- errors.New("all servers failed to return a result")
				}
				return
			}

			select {
			case resultChan <- res:
			default:
			}
		}(server)
	}

	// –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º resultChan
	go func() {
		wg.Wait()
		close(resultChan)
	}()

	// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —É–¥–∞–ª–∏—Å—å
	select {
	case res := <-resultChan:
		return res, nil
	case err := <-errorChan:
		return nil, err
	}
}
```

---

## ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**
1. üîÑ **–£–±—Ä–∞–ª–∏ `default` –≤ `select`**, —Ç–µ–ø–µ—Ä—å –∫–æ–¥ –∂–¥–µ—Ç **—Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞** –æ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤.  
2. üîÑ **–î–æ–±–∞–≤–∏–ª–∏ —É—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—à–∏–±–æ–∫ (`errorCount`)**, —á—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `"all servers failed"` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ **–≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –≤–µ—Ä–Ω—É–ª–∏ –æ—à–∏–±–∫—É**.  
3. üîÑ **–ó–∞–∫—Ä—ã–≤–∞–µ–º `resultChan` —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω** (`wg.Wait()`), **–Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º `errorChan`**, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å `panic`.  

–¢–µ–ø–µ—Ä—å –∫–æ–¥ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ** –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É! üöÄ



--------




## –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞

–≠—Ç–æ—Ç –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç **–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π) –ø–æ–∏—Å–∫** –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**. –ï—Å–ª–∏ **–≤—Å–µ —Å–µ—Ä–≤–µ—Ä–∞** –≤–µ—Ä–Ω—É–ª–∏ –æ—à–∏–±–∫—É, —Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É.

### üîπ **–û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**
```go
var wg sync.WaitGroup
resultChan := make(chan []string, 1)  // –ö–∞–Ω–∞–ª –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
errorChan := make(chan error, len(servers))  // –ö–∞–Ω–∞–ª –¥–ª—è –æ—à–∏–±–æ–∫
var errorCount int
var errorMutex sync.Mutex
```
1. **`wg sync.WaitGroup`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω**.
2. **`resultChan := make(chan []string, 1)`**  
   - –ö–∞–Ω–∞–ª –¥–ª—è **—É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**.
   - **–ë—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π (—Ä–∞–∑–º–µ—Ä 1)**, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≥–æ—Ä—É—Ç–∏–Ω.
3. **`errorChan := make(chan error, len(servers))`**  
   - –ö–∞–Ω–∞–ª –¥–ª—è **–æ—à–∏–±–æ–∫ –æ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤**.
   - **–ë—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π**, —á—Ç–æ–±—ã –≤–º–µ—Å—Ç–∏—Ç—å –æ—à–∏–±–∫–∏ –æ—Ç –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.
4. **`var errorCount int`** ‚Äî **—Å—á–µ—Ç—á–∏–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—à–∏–±–æ–∫**.
5. **`var errorMutex sync.Mutex`** ‚Äî –Ω—É–∂–µ–Ω –¥–ª—è **–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è `errorCount`**.

---

### üîπ **–ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö**
```go
for _, server := range servers {
    wg.Add(1)
    go func(server string) {
        defer wg.Done()
```
- –¶–∏–∫–ª **–∑–∞–ø—É—Å–∫–∞–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞**.
- **`wg.Add(1)`** —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ `WaitGroup`, —á—Ç–æ–±—ã —É—á–∏—Ç—ã–≤–∞—Ç—å –Ω–æ–≤—É—é –≥–æ—Ä—É—Ç–∏–Ω—É.
- **`defer wg.Done()`** —É–º–µ–Ω—å—à–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ `WaitGroup`, –∫–æ–≥–¥–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

---

### üîπ **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
```go
res, err := search.Search(server, query)
if err != nil {
    errorMutex.Lock()
    errorCount++
    errorMutex.Unlock()

    if errorCount == len(servers) {
        errorChan <- errors.New("all servers failed to return a result")
    }
    return
}
```
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è **–≤–Ω–µ—à–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è** `search.Search(server, query)`, –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è –ø–æ–∏—Å–∫.
- –ï—Å–ª–∏ **—Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É**:
  1. **–ë–ª–æ–∫–∏—Ä—É–µ–º –º—å—é—Ç–µ–∫—Å (`errorMutex.Lock()`)** –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º `errorCount`.
  2. **–†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –º—å—é—Ç–µ–∫—Å (`errorMutex.Unlock()`)**.
  3. **–ï—Å–ª–∏ –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –≤–µ—Ä–Ω—É–ª–∏ –æ—à–∏–±–∫–∏** (`errorCount == len(servers)`), –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º `"all servers failed to return a result"` –≤ `errorChan`.

---

### üîπ **–û—Ç–ø—Ä–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**
```go
select {
case resultChan <- res:
default:
}
```
- **–ï—Å–ª–∏ –∫–∞–Ω–∞–ª `resultChan` –ø—É—Å—Ç**, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—É–¥–∞ `res` (—Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤).
- **–ï—Å–ª–∏ `resultChan` —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω**, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º (—Ç–∞–∫ –∫–∞–∫ `select` —Å `default` –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É).

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ **–ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç** –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –∞ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ **–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è**.

---

### üîπ **–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –∫–∞–Ω–∞–ª–æ–≤**
```go
go func() {
    wg.Wait()
    close(resultChan)
}()
```
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞** –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω.
- **`wg.Wait()`** –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω.
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ **–∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è `resultChan`**.

**–ü–æ—á–µ–º—É `errorChan` –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è?**  
- –ï–≥–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å **–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**, —Ç–∞–∫ –∫–∞–∫ –≤ `select` –º—ã —á–∏—Ç–∞–µ–º **—Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ**.  
- –ï—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç—å `errorChan`, –¥—Ä—É–≥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –Ω–µ–≥–æ –æ—à–∏–±–∫—É, –≤—ã–∑–≤–∞–≤ `panic`.

---

### üîπ **–û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–∏–ª–∏ –æ—à–∏–±–∫–∏)**
```go
select {
case res := <-resultChan:
    return res, nil
case err := <-errorChan:
    return nil, err
}
```
- **`select` –∂–¥–µ—Ç**:
  - –ï—Å–ª–∏ **–µ—Å—Ç—å —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (`resultChan`)**, –æ–Ω **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è**.
  - –ï—Å–ª–∏ **–≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –≤–µ—Ä–Ω—É–ª–∏ –æ—à–∏–±–∫–∏ (`errorChan`)**, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞.

---

## ‚úÖ **–ü–æ—á–µ–º—É —ç—Ç–æ—Ç –∫–æ–¥ —Ö–æ—Ä–æ—à–∏–π?**
1. **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π (–±—ã—Å—Ç—Ä—ã–π)**  
   - –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö**.
   - –ñ–¥–µ—Ç **–ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** –∏ **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

2. **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö**  
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **`sync.Mutex`**, —á—Ç–æ–±—ã **–±–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å** `errorCount`.

3. **–ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫**  
   - –û—à–∏–±–∫–∏ **–Ω–µ –º–µ—à–∞—é—Ç** –≤–æ–∑–≤—Ä–∞—Ç—É —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
   - **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è –æ—à–∏–±–∫–∞**, –µ—Å–ª–∏ –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ –¥–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

---

## üî• **–ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å?**
### ‚ùå **–û—à–∏–±–∫–∞: `errorCount` –Ω–µ –∞—Ç–æ–º–∞—Ä–Ω—ã–π**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `sync.Mutex` –¥–ª—è **–ø—Ä–æ—Å—Ç–æ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞** ‚Äî **–∏–∑–±—ã—Ç–æ—á–Ω–æ**. –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `atomic.Int32`.

### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ —Å `atomic.Int32`**
```go
package main

import (
	"errors"
	"sync"
	"sync/atomic"
)

func Search(servers []string, query string) ([]string, error) {
	var wg sync.WaitGroup
	resultChan := make(chan []string, 1)
	errorChan := make(chan error, 1) // –¢–µ–ø–µ—Ä—å –±—É—Ñ–µ—Ä 1, —á—Ç–æ–±—ã –Ω–µ –∫–æ–ø–∏—Ç—å –æ—à–∏–±–∫–∏
	var errorCount atomic.Int32

	for _, server := range servers {
		wg.Add(1)
		go func(server string) {
			defer wg.Done()

			res, err := search.Search(server, query)
			if err != nil {
				if errorCount.Add(1) == int32(len(servers)) {
					select {
					case errorChan <- errors.New("all servers failed to return a result"):
					default:
					}
				}
				return
			}

			select {
			case resultChan <- res:
			default:
			}
		}(server)
	}

	// –û–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º resultChan
	go func() {
		wg.Wait()
		close(resultChan)
	}()

	// –û–∂–∏–¥–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫—É
	select {
	case res := <-resultChan:
		return res, nil
	case err := <-errorChan:
		return nil, err
	}
}
```

### üîπ **–ß—Ç–æ —É–ª—É—á—à–∏–ª–æ—Å—å?**
‚úÖ **–ó–∞–º–µ–Ω–∏–ª–∏ `sync.Mutex` –Ω–∞ `atomic.Int32`** ‚Üí —Ç–µ–ø–µ—Ä—å `errorCount` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è **–∞—Ç–æ–º–∞—Ä–Ω–æ** –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.  
‚úÖ **`errorChan` —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –±—É—Ñ–µ—Ä 1** ‚Üí **–Ω–µ –∫–æ–ø–∏—Ç –æ—à–∏–±–∫–∏**, —Ç–∞–∫ –∫–∞–∫ –Ω–∞–º –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞.  
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ–º `select { case errorChan <- err: default: }`** ‚Üí —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ `panic`, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞.  

–¢–µ–ø–µ—Ä—å –∫–æ–¥ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω, –±–µ–∑–æ–ø–∞—Å–µ–Ω –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–µ–Ω! üöÄ**
