–†–∞–∑–±–µ—Ä—ë–º—Å—è –ø–æ —à–∞–≥–∞–º:

---

## üîé –ß—Ç–æ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–æ

### –ö–æ–¥:

```go
m := make(map[string]int)
m["a"] = 1

p := &m["a"]
*p = 42

fmt.Println(m)
```

---

### ‚ùó –û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:

```bash
cannot take the address of m["a"]
```

---

### üìå –ü–æ—á–µ–º—É?

–í Go **–Ω–µ–ª—å–∑—è –≤–∑—è—Ç—å –∞–¥—Ä–µ—Å —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞–ø—ã –Ω–∞–ø—Ä—è–º—É—é**:

```go
p := &m["a"] // ‚ùå –æ—à–∏–±–∫–∞
```

–ü–æ—Ç–æ–º—É —á—Ç–æ:

* –ú–∞–ø—ã –≤ Go **–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏**.
* –ú–∞–ø–∞ ‚Äî —ç—Ç–æ **—Ö–µ—à-—Ç–∞–±–ª–∏—Ü–∞**, –∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (–≤—Å—Ç–∞–≤–∫–∞/—É–¥–∞–ª–µ–Ω–∏–µ/—ç–≤–∞–∫—É–∞—Ü–∏—è) —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å **–ø–µ—Ä–µ–º–µ—â–µ–Ω—ã** –∏–ª–∏ **—É–¥–∞–ª–µ–Ω—ã**.
* –ï—Å–ª–∏ –±—ã Go –ø–æ–∑–≤–æ–ª–∏–ª –±—Ä–∞—Ç—å –∞–¥—Ä–µ—Å `&m["a"]`, –æ–Ω –±—ã –Ω–µ –º–æ–≥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –±—É–¥–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –ø–æ–∑–∂–µ.

---

### ‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞—Ç–µ–ª—å ‚Äî —Å–¥–µ–ª–∞–π —ç—Ç–æ —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:

```go
v := m["a"]
p := &v
*p = 42

m["a"] = *p
fmt.Println(m) // map[a:42]
```

---

## üì¶ –ß—Ç–æ —Ç–∞–∫–æ–µ `map` –≤ Go

–ú–∞–ø–∞ –≤ Go ‚Äî —ç—Ç–æ **–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ö–µ—à-—Ç–∞–±–ª–∏—Ü–∞**, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤ runtime.

–û–±—ä—è–≤–ª–µ–Ω–∏–µ:

```go
m := make(map[string]int)
```

–°–æ–∑–¥–∞—ë—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–≥–æ –≤–∏–¥–∞:

```go
type hmap struct {
    count     int           // –∫–æ–ª-–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    flags     uint8
    B         uint8         // –ª–æ–≥–∞—Ä–∏—Ñ–º –æ—Ç —á–∏—Å–ª–∞ –±–∞–∫–µ—Ç–æ–≤ (2^B –±–∞–∫–µ—Ç–æ–≤)
    buckets   *bmap         // –º–∞—Å—Å–∏–≤ –±–∞–∫–µ—Ç–æ–≤
    oldbuckets *bmap        // –ø—Ä–∏ —ç–≤–∞–∫—É–∞—Ü–∏–∏ ‚Äî —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
    nevacuate uintptr       // –ø—Ä–æ–≥—Ä–µ—Å—Å —ç–≤–∞–∫—É–∞—Ü–∏–∏
    ...
}
```

---

## üß† –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω `map` (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)

* –ö–ª—é—á —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è ‚Üí –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å –±–∞–∫–µ—Ç–∞
* –í –∫–∞–∂–¥–æ–º –±–∞–∫–µ—Ç–µ ‚Äî –¥–æ 8 –ø–∞—Ä –∫–ª—é—á/–∑–Ω–∞—á–µ–Ω–∏–µ
* –ï—Å–ª–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Äî —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∞–∫–µ—Ç—ã
* –ö –∫–æ–ª–ª–∏–∑–∏—è–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **–æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ **–æ—Ç–∫—Ä—ã—Ç–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è**

---

## üîÑ –ß—Ç–æ —Ç–∞–∫–æ–µ **—ç–≤–∞–∫—É–∞—Ü–∏—è (evacuation)**

–ö–æ–≥–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ä–∞—Å—Ç—ë—Ç, Go **—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∫–µ—Ç–æ–≤** (–≤ 2 —Ä–∞–∑–∞), —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

–≠–≤–∞–∫—É–∞—Ü–∏—è ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å **–ø–µ—Ä–µ–Ω–æ—Å–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ —Å—Ç–∞—Ä—ã—Ö –±–∞–∫–µ—Ç–æ–≤ –≤ –Ω–æ–≤—ã–µ**.

### –ü–æ—à–∞–≥–æ–≤–æ:

1. –ö–æ–≥–¥–∞ `count > loadFactor * 2^B`, —Å–æ–∑–¥–∞—ë—Ç—Å—è `oldbuckets = buckets`
2. –°–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ `buckets` –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ
3. –ù–æ–≤—ã–µ –≤—Å—Ç–∞–≤–∫–∏ –∏ —á—Ç–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä—è—Ç **–ø–æ—ç—Ç–∞–ø–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å (evacuation)** —ç–ª–µ–º–µ–Ω—Ç–æ–≤
4. –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏/–∑–∞–ø–∏—Å–∏ –≤ —Å—Ç–∞—Ä—ã–π –±–∞–∫–µ—Ç Go **–ø–µ—Ä–µ–Ω–æ—Å–∏—Ç** –µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –Ω–æ–≤—ã–π –∏ –ø–æ–º–µ—á–∞–µ—Ç –∫–∞–∫ —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
5. –ü–æ—Å–ª–µ –≤—Å–µ—Ö —ç–≤–∞–∫—É–∞—Ü–∏–π `oldbuckets = nil`

---

## üö® –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è `&m["a"]` ‚Äî –∏—Ç–æ–≥

* –≠–≤–∞–∫—É–∞—Ü–∏—è –º–æ–∂–µ—Ç **–ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å** —ç–ª–µ–º–µ–Ω—Ç—ã ‚Äî —Å—Å—ã–ª–∫–∏ —É—Å—Ç–∞—Ä–µ–≤–∞—é—Ç.
* –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ `m["a"]` –≤—Å—ë –µ—â—ë **–≤ —Ç–æ–º –∂–µ –º–µ—Å—Ç–µ –≤ –ø–∞–º—è—Ç–∏**, —á—Ç–æ –∏ –¥–æ –≤—Å—Ç–∞–≤–∫–∏ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
* –ü–æ—ç—Ç–æ–º—É Go –∑–∞–ø—Ä–µ—â–∞–µ—Ç –±—Ä–∞—Ç—å –∞–¥—Ä–µ—Å: **–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —É–¥–æ–±—Å—Ç–≤–∞.**

---

## üß™ –•–æ—á–µ—à—å –ø–æ—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å?

–ü–æ–ø—Ä–æ–±—É–π:

```go
m := make(map[string]int)
for i := 0; i < 1000; i++ {
    m[fmt.Sprintf("key%d", i)] = i
}
fmt.Println(len(m))
```

–î–æ–±–∞–≤—å –≤ `runtime` —Ñ–ª–∞–≥ `GODEBUG=mapdebug=1`, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —ç–≤–∞–∫—É–∞—Ü–∏–∏ (–µ—Å–ª–∏ –±—ã –±—ã–ª –¥–æ—Å—Ç—É–ø –∫ –Ω–∏–º —á–µ—Ä–µ–∑ GODEBUG).

---

–•–æ—á–µ—à—å —è –Ω–∞—Ä–∏—Å—É—é —Å—Ö–µ–º—É —Å –±–∞–∫–µ—Ç–∞–º–∏, —á—Ç–æ–±—ã –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ `map`?
