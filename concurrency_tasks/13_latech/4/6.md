1) У нас есть составной индекс myIdx, в запросе у нас нет фильтрации по customer_id, этот индекс будет использоваться?

CREATE INDEX myIdx ON carts(customer_id, sku, country);

Как узнать будет ли использоваться индекс?
Можно посмотреть через explaine.

#### Почему индекс может не использоваться

1. **Порядок столбцов**: Составные индексы работают по принципу "слева направо". Это означает, что для эффективного использования индекса необходимо фильтровать по первому столбцу индекса (`customer_id` в вашем случае). Если фильтрация идет только по `sku` или `country`, индекс может не использоваться.

2. **Тип запроса**: Если запрос не содержит условий, которые могут быть оптимизированы с помощью индекса, например, если он просто выбирает все строки или использует сложные условия, индекс также может не использоваться.

### Как узнать, будет ли использоваться индекс

Чтобы проверить, будет ли использоваться индекс в вашем запросе, вы можете воспользоваться следующими методами:

1. **EXPLAIN**: Используйте команду `EXPLAIN` перед вашим запросом. Это покажет, как SQL-сервер планирует выполнить запрос и какие индексы будут использоваться. Например:

   ```sql
   EXPLAIN SELECT * FROM carts WHERE sku = 'some_value';
   ```

   В результате вы увидите информацию о том, будет ли использоваться индекс `myIdx`.

2. **Профилирование запросов**: В некоторых системах управления базами данных (СУБД) вы можете включить профилирование запросов, чтобы получить более детальную информацию о том, как выполняются запросы и какие индексы используются.

3. **Анализ производительности**: Запустите запрос с и без индекса и сравните время выполнения. Если запрос выполняется значительно быстрее с индексом, это может указывать на его использование.

2) У нас есть индекс myIdx по колонке country. Всегда ли он будет работать? Какая характеристика используется при анализе применения индекса?

CREATE INDEX myIdx ON carts(country);

Селективностью индекса назвается характеристика, определяющая, насколько эффективно индекс разбивает данные.

Индекс – это отсортированный набор значений. Применяются для уменьшения времени выполнения запроса. Создаются для колонки при условии использования в:

WHERE;
ORDER BY;
Агрегатных функциях(MIN и MAX).

Составной индекс - индекс, который создан по 2+ полям. Работает так же как и обычный индекс, но информация из колонок храниться вместе. Очередность колонок в индексе важна. Обычно колонки, которые используются в условиях WHERE, следует ставить в начало индекса. Колонки из ORDER BY — в конец.


Селективность колонки определяется количеством записей в таблице с одинаковыми значениями. Когда записей с одинаковым значением мало – селективность высокая. Такие колонки необходимо использовать первыми в составных индексах.

Лекция 6 Индексы и селективность от Postgres Pro
https://edu.postgrespro.ru/sqlprimer/sqlprimer-2019-msu-06.pdf


https://neerc.ifmo.ru/wiki/index.php?title=%D0%98%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%D0%B0%D1%86%D0%B8%D1%8F_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85._%D0%94%D1%80%D1%83%D0%B3%D0%B8%D0%B5_%D1%82%D0%B8%D0%BF%D1%8B_%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%D0%BE%D0%B2._%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%D0%BE%D0%B2&mobileaction=toggle_view_desktop