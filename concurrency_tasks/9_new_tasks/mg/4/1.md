32:00
1) Что такое индекс?
2) Что такое селективность индекса?
Если у нас мало различных значений столбца, то использование индекса может замедлить работу запроса. Потому что менеджер запросов будет терять время на принятие решений стоит ли использовать индекс, не будет использовать его и будет использовать sequence scan (Sequential Scan) - последовательное сканирование.

Оптимизатор запроса: https://infostart.ru/1c/articles/1172359/

11 Методов оптимизации SQL-запросов, обычно используемых в проектах: https://dzen.ru/a/YtZh8w4yXCQoTBp3

Пример неселективной колонки female. Потому что там 2 уникальных значения man и woman.
Пример селективной колонки timestamp и primary key. Множество уникальных значений.

3) Составной индекс.

Это индекс сразу на несколько полей.

Если мы используем один индекс, то он только один применится по одному столбцу. А если мы используем составной индекс, то мы можем сразу по нескольким столбцам использовать индекс.

Важен ли порядок в составном индексе?
Правило использования составного индекса: Столбцы, которые будет сравниваться на знак равно, до первого знака неравенство. И после 
все что мы напишем в составном индексе не будет использоваться.

Точное правило состоит в том, что сканируемая область индекса определяется условиями равенства с ведущими столбцами и условиями неравенства с первым столбцом, не участвующим в условии равенства. Ограничения столбцов правее них также проверяются по индексу, так что обращение к таблице откладывается, но на размер сканируемой области индекса это уже не влияет. Например, если есть индекс по столбцам (a, b, c) и условие WHERE a = 5 AND b >= 42 AND c < 77, индекс будет сканироваться от первой записи a = 5 и b = 42 до последней с a = 5. Записи индекса, в которых c >= 77, не будут учитываться, но, тем не менее, будут просканированы. Этот индекс в принципе может использоваться в запросах с ограничениями по b и/или c, без ограничений столбца a, но при этом будет просканирован весь индекс, так что в большинстве случаев планировщик предпочтёт использованию индекса полное сканирование таблицы.
Источник: https://postgrespro.ru/docs/postgrespro/9.5/indexes-multicolumn

31) А в запросе может использоватся несколько одиночных индексов? 

Хотя в запросе могут использоваться несколько одиночных индексов, оптимизатор базы данных, как правило, выбирает только один индекс для выполнения запроса. Для улучшения производительности запросов, которые фильтруют по нескольким столбцам, рекомендуется использовать составные индексы.

4) Частичный индекс.

Частичный индекс — это тип индекса в реляционных базах данных, который создается только для подмножества строк таблицы, соответствующих определенному условию. 

Пример: 
CREATE INDEX clients_ip ON orders (client_ip_address) 
WHERE NOT (client_ip_address > '10.26.74.1' AND client_ip_address < '10.26.74.2');

36:30
5) Покрывающий индекс.
Покрывающий индекс — это индекс, который содержит весь набор полей для запроса.

Пример индекса для запроса:
CREATE INDEX idx_position_salary ON employees (position, salary);
Теперь, если мы выполняем запрос:
sql

Запрос:
SELECT name, salary FROM employees WHERE position = 'Manager';

37:00
6) Транзакция

7) Принципы ACID

8) Уровни изоляции транзакций

9) Партицирование, реплицирование, шардирование.

Репликация - это процесс копирования и поддержания данных в нескольких местах.

Шардирование - это разные между собой сервера с разделением данных одной таблицы на эти несколько серверов.

Партицирование в рамках одной БД, только в разные таблицы и в разные места на диске, чтобы было быстрее читать.

Партиционирование — это процесс разделения таблицы на более мелкие, управляемые части, называемые партициями. Каждая партиция может хранить данные, соответствующие определенному критерию, например, диапазону значений или определенной категории. Это позволяет улучшить производительность запросов, так как база данных может быстро находить нужные данные в конкретной партиции, а не просматривать всю таблицу. Например, таблица заказов может быть партиционирована по дате, где каждая партиция содержит данные за определенный месяц.

Репликация — это процесс создания и поддержания копий данных на нескольких серверах. Это позволяет повысить доступность и отказоустойчивость системы. Если один сервер выходит из строя, данные все равно будут доступны на других серверах. Репликация может быть синхронной (где изменения сразу же отражаются на всех копиях) или асинхронной (где изменения могут задерживаться). Например, в веб-приложении можно использовать репликацию для обеспечения высокой доступности базы данных, распределяя запросы на чтение между несколькими репликами.

Шардирование — это метод горизонтального разделения данных, при котором база данных разбивается на несколько частей, называемых шардами. Каждый шард хранит только часть данных, что позволяет распределить нагрузку и улучшить производительность. Шардирование может быть основано на различных ключах, таких как идентификаторы пользователей или географические регионы. Например, в крупном интернет-магазине данные о пользователях могут быть распределены по разным шартам в зависимости от их местоположения, что позволяет эффективно обрабатывать запросы и уменьшать время отклика.

10) Брокер сообщений.

Брокер - средство асинхронного взаимодействия между сервисами, который дает нам эту возможность и надежность, за счет того, что берет на себя обязательство по сохранению сообщений.

11) Для чего придумали брокеры сообщений?

1. Асинхронная обработка
Брокеры сообщений позволяют компонентам системы обмениваться данными асинхронно. Это означает, что отправитель может отправить сообщение и продолжить свою работу, не дожидаясь ответа от получателя. Это значительно повышает производительность системы, так как компоненты могут работать независимо друг от друга.
2. Разгрузка веб-сервисов
Использование брокеров сообщений помогает разгрузить веб-сервисы, так как они могут отправлять сообщения в брокер, не заботясь о том, как и когда эти сообщения будут обработаны. Это позволяет избежать перегрузки сервисов и улучшает их отзывчивость.
3. Масштабируемость
Брокеры сообщений обеспечивают легкую масштабируемость системы. При увеличении нагрузки можно добавлять новые экземпляры консьюмеров, которые будут обрабатывать сообщения, не требуя изменений в логике отправителей.
4. Устойчивость к сбоям
Брокеры сообщений обеспечивают надежность и отказоустойчивость системы. Если один из компонентов выходит из строя, сообщения могут быть временно сохранены в брокере и обработаны позже, когда компонент станет доступен.
5. Гибкость архитектуры
Брокеры сообщений упрощают архитектуру системы, позволяя различным компонентам взаимодействовать друг с другом без жесткой привязки. Это делает систему более гибкой и упрощает добавление новых функций или компонентов.

12) Из чего состоит кафка? 

Консьюмер, продюсер, сам брокер. В брокере данные можно кидать в топик. Если мы хотим из нескольких консьюмер груп читать сообщения и при этом до каждого оно доходило нам нужно разделить консьюмеров по разным группам. Потому что, другие консьюмеры не получат сообщения, если один из них получит сообщение.

Еще есть партиции, за счет них мы можем ускорять работу брокера.
Реплики, можно создать несколько реплик партиции за счет конфигурации репликейшн фактор.

1. Брокеры
Брокеры — это серверы, которые составляют кластер Kafka. Каждый брокер отвечает за хранение и управление сообщениями, поступающими в топики. Кластер может состоять из одного или нескольких брокеров, что обеспечивает отказоустойчивость и масштабируемость системы 
.
2. Топики
Топики — это логические каналы, в которые производители (producers) записывают сообщения, а потребители (consumers) читают их. Каждый топик может быть разбит на несколько партиций, что позволяет распределять нагрузку и обеспечивать параллельную обработку данных.
3. Партиции
Партиции — это подмножества топиков, которые позволяют Kafka обрабатывать данные параллельно. Каждая партиция хранит упорядоченные сообщения и обеспечивает возможность масштабирования, так как разные консьюмеры могут обрабатывать разные партиции одновременно.
4. Производители (Producers)
Производители — это приложения или сервисы, которые отправляют сообщения в топики. Они могут выбирать, в какую партицию отправить сообщение, что позволяет контролировать распределение нагрузки.
5. Потребители (Consumers)
Потребители — это приложения или сервисы, которые читают сообщения из топиков. Они могут работать в группах, что позволяет им совместно обрабатывать сообщения из разных партиций.
6. Зоопарки (ZooKeeper)
ZooKeeper — это компонент, который используется для управления конфигурацией и координации брокеров в кластере Kafka. Он обеспечивает высокую доступность и согласованность данных, а также помогает отслеживать состояние брокеров и их партиций.

13) Что будет если консьюмеров меньше чем партиций и консьюмеров больше чем партиций?

1. Консьюмеров меньше, чем партиций
Когда количество консьюмеров в группе меньше, чем количество партиций, некоторые партиции останутся без обработки. Например, если у вас есть 4 партиции и 2 консьюмера в группе, то каждый консьюмер будет обрабатывать по 2 партиции, а 2 партиции останутся неактивными. Это может привести к тому, что сообщения в этих партициях не будут обрабатываться, пока не появится дополнительный консьюмер.
2. Консьюмеров больше, чем партиций
Если количество консьюмеров в группе превышает количество партиций, то некоторые консьюмеры будут простаивать. Например, если у вас есть 3 партиции и 5 консьюмеров, то только 3 консьюмера будут активно обрабатывать сообщения, а 2 консьюмера останутся без работы. Это неэффективно, так как ресурсы остаются неиспользованными.

Что происходит, когда мы все сообщения вычитали из определенной партиции? Что кафка делает?

14) Перебалансировка в Apache Kafka

Перебалансировка в Apache Kafka
Перебалансировка (rebalance) в Apache Kafka — это процесс перераспределения партиций между консьюмерами в группе. Этот механизм важен для обеспечения эффективной обработки сообщений и поддержания высокой доступности системы. Давайте рассмотрим, как работает перебалансировка и когда она происходит.
Когда происходит перебалансировка?
Перебалансировка может произойти в следующих случаях:
Добавление или удаление консьюмеров: Когда новый консьюмер присоединяется к группе или существующий консьюмер отключается, Kafka инициирует перебалансировку, чтобы перераспределить партиции между активными консьюмерами. Это позволяет всем консьюмерам получать сообщения из разных партиций.
Сбой консьюмера: Если консьюмер перестает отправлять heartbeat-сигналы координатору группы (например, из-за сбоя), происходит перебалансировка, чтобы освободить его партиции и перераспределить их между оставшимися консьюмерами.
Изменение конфигурации: Изменения в конфигурации группы консьюмеров, такие как изменение параметров таймаутов, также могут вызвать перебалансировку.
Как работает перебалансировка?
Координатор группы: Каждый раз, когда происходит перебалансировка, координатор группы (специальный брокер) отвечает за управление процессом. Он отслеживает состояние консьюмеров и партиций.
Перераспределение партиций: Во время перебалансировки координатор определяет, какие партиции должны быть перераспределены между консьюмерами. Это может привести к тому, что некоторые консьюмеры начнут обрабатывать новые партиции, а другие — освободят свои текущие партиции.
Временные задержки: Перебалансировка может вызвать временные задержки в обработке сообщений, так как консьюмеры могут быть недоступны на время перераспределения партиций. Это явление иногда называют "stop-the-world" эффектом, когда все консьюмеры временно приостанавливают обработку сообщений.

14) Консистентность ключа.
