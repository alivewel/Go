1) –ü–æ–∏—Å–∫ –ø–æ –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–º—É –Ω–µ–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –º–∞—Å—Å–∏–≤—É —Å —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏–µ–º –Ω–∞ Go

```go
package main

import (
	"fmt"
	"math/rand"
	"runtime"
	"sync"
	"time"
)

func main() {
	const size = 100_000_000
	const target = 42

	// –°–æ–∑–¥–∞—ë–º –±–æ–ª—å—à–æ–π –Ω–µ–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
	arr := make([]int, size)
	for i := range arr {
		arr[i] = rand.Intn(1_000_000)
	}
	// –°—Ç–∞–≤–∏–º —Ü–µ–ª—å, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –±—ã–ª–∞
	arr[size/2] = target

	numCPU := runtime.NumCPU()
	chunkSize := size / numCPU
	var wg sync.WaitGroup
	found := make(chan bool, 1) // –±—É—Ñ–µ—Ä 1, —á—Ç–æ–±—ã –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è

	start := time.Now()

	for i := 0; i < numCPU; i++ {
		wg.Add(1)
		go func(startIndex int) {
			defer wg.Done()
			end := startIndex + chunkSize
			if end > size {
				end = size
			}
			for _, v := range arr[startIndex:end] {
				if v == target {
					select {
					case found <- true:
					default: // –µ—Å–ª–∏ —É–∂–µ –Ω–∞–π–¥–µ–Ω ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º—Å—è
					}
					return
				}
			}
		}(i * chunkSize)
	}

	go func() {
		wg.Wait()
		close(found)
	}()

	if <-found {
		fmt.Println("–ß–∏—Å–ª–æ –Ω–∞–π–¥–µ–Ω–æ!")
	} else {
		fmt.Println("–ß–∏—Å–ª–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")
	}

	fmt.Println("–í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞:", time.Since(start))
}
```

### ‚úÖ –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –æ—Ç–º–µ–Ω–æ–π —á–µ—Ä–µ–∑ `context`:

```go
package main

import (
	"context"
	"fmt"
	"math/rand"
	"runtime"
	"sync"
	"time"
)

func main() {
	const size = 100_000_000
	const target = 42

	// 1. –°–æ–∑–¥–∞—ë–º –±–æ–ª—å—à–æ–π –º–∞—Å—Å–∏–≤
	arr := make([]int, size)
	for i := range arr {
		arr[i] = rand.Intn(1_000_000)
	}
	arr[size/2] = target // —Ç–æ—á–Ω–æ –≤—Å—Ç–∞–≤–∏–º —ç–ª–µ–º–µ–Ω—Ç

	// 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏—è
	numCPU := runtime.NumCPU()
	chunkSize := size / numCPU

	ctx, cancel := context.WithCancel(context.Background())
	defer cancel() // safety

	var wg sync.WaitGroup
	found := make(chan bool, 1)

	start := time.Now()

	for i := 0; i < numCPU; i++ {
		wg.Add(1)
		go func(startIndex int) {
			defer wg.Done()
			end := startIndex + chunkSize
			if end > size {
				end = size
			}

			for _, v := range arr[startIndex:end] {
				select {
				case <-ctx.Done():
					// –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç–º–µ–Ω—ë–Ω ‚Äî –≤—ã—Ö–æ–¥–∏–º –¥–æ—Å—Ä–æ—á–Ω–æ
					return
				default:
					if v == target {
						select {
						case found <- true:
						default:
						}
						cancel() // –æ—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≥–æ—Ä—É—Ç–∏–Ω—ã
						return
					}
				}
			}
		}(i * chunkSize)
	}

	go func() {
		wg.Wait()
		close(found)
	}()

	if <-found {
		fmt.Println("‚úÖ –ß–∏—Å–ª–æ –Ω–∞–π–¥–µ–Ω–æ")
	} else {
		fmt.Println("‚ùå –ß–∏—Å–ª–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
	}

	fmt.Println("‚è± –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞:", time.Since(start))
}
```

2) –í Go Escape analysis, –≤ PostgreSQL EXPLAIN ANALYZE.

–î–ª—è –≤—ã–∑–æ–≤–∞ escape analysis –≤ Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–ª–∞–≥ `-gcflags="-m"`.

3) –í–æ—Ç –∫—Ä–∞—Ç–∫–∞—è, –Ω–æ —Ç–æ—á–Ω–∞—è **—Ç–µ–æ—Ä–∏—è –ø–æ —Å–±–æ—Ä—â–∏–∫—É –º—É—Å–æ—Ä–∞ (–ì–¶)** –≤ Go, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ **–∞–ª–≥–æ—Ä–∏—Ç–º–µ Mark and Sweep**, —Å —É—á—ë—Ç–æ–º —Ç–æ–≥–æ, **–∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Go-runtime**.

---

## ‚ôªÔ∏è –ß—Ç–æ —Ç–∞–∫–æ–µ GC (Garbage Collector)

–°–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ ‚Äî —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–Ω—Ç–∞–π–º–∞, –∫–æ—Ç–æ—Ä—ã–π **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é –ø–∞–º—è—Ç—å**, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —É—Ç–µ—á–∫–∏ –∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ.

---

## üìå –ê–ª–≥–æ—Ä–∏—Ç–º **Mark and Sweep** ‚Äî –æ–±—â–∞—è –∏–¥–µ—è

–≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º:

1. **Mark (–æ—Ç–º–µ—Ç—å)**:

   * GC –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º **–∂–∏–≤—ã–º –æ–±—ä–µ–∫—Ç–∞–º** (–¥–æ—Å—Ç–∏–∂–∏–º—ã–º –∏–∑ root-–æ–±—ä–µ–∫—Ç–æ–≤: —Å—Ç–µ–∫–æ–≤, –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Ç.–ø.).
   * –ü–æ–º–µ—á–∞–µ—Ç –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã, –¥–æ –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–µ—Ç –¥–æ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º.

2. **Sweep (—Å–æ–±–µ—Ä–∏)**:

   * –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–π –ø–∞–º—è—Ç–∏ –∏ **—É–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç—ã, –Ω–µ –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ** –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —à–∞–≥–µ.
   * –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å –ø–æ–¥ –Ω–∏—Ö.

---

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç GC –≤ Go (–Ω–∞—á–∏–Ω–∞—è —Å Go 1.5+)

Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç—Ä–∞—Å—Å–∏—Ä—É—é—â–∏–π, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π GC**.
–í –æ—Å–Ω–æ–≤–µ ‚Äî **Mark and Sweep**, –Ω–æ —Å –≤–∞–∂–Ω—ã–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏:

### üí° –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∑—ã:

| –§–∞–∑–∞                 | –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç                                           |
| -------------------- | -------------------------------------------------------- |
| **STW - Start**      | –ö–æ—Ä–æ—Ç–∫–∞—è –ø–∞—É–∑–∞, –∑–∞–ø—É—Å–∫–∞–µ—Ç GC                             |
| **Mark**             | –ü–æ—Ç–æ–∫–∞–º–∏ –æ–±—Ö–æ–¥–∏—Ç –æ–±—ä–µ–∫—Ç—ã –∏–∑ root-–Ω–∞–±–æ—Ä–æ–≤, –ø–æ–º–µ—á–∞–µ—Ç –∂–∏–≤—ã–µ |
| **Concurrent Sweep** | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —É–¥–∞–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã               |
| **STW - End**        | –ó–∞–≤–µ—Ä—à–∞–µ—Ç GC, –Ω–∞–≤–æ–¥–∏—Ç –ø–æ—Ä—è–¥–æ–∫                            |

### üßµ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ä–∞–±–æ—Ç–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

* GC **–Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∏—Ä (Stop The World) –Ω–∞–¥–æ–ª–≥–æ**, –∫–∞–∫ —Ä–∞–Ω—å—à–µ.
* –¢–æ–ª—å–∫–æ **–≤ –Ω–∞—á–∞–ª–µ –∏ –≤ –∫–æ–Ω—Ü–µ** ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–µ STW-—Ñ–∞–∑—ã (–Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥).
* –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–≤ —Ñ–æ–Ω–µ (background GC)**, –±–µ–∑ –ø–æ–ª–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

---

## ‚öôÔ∏è –ö–∞–∫ GC –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø–æ—Ä–∞ —á–∏—Å—Ç–∏—Ç—å?

Go GC —Ä–∞–±–æ—Ç–∞–µ—Ç **–ø–æ —Ç—Ä–∏–≥–≥–µ—Ä—É –æ–±—ä—ë–º–∞ –≤—ã–¥–µ–ª–µ–Ω–∏–π**:

* –ö–æ–≥–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–¥–µ–ª–∏–ª–∞ **\~100% –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ü–∏–∫–ª–∞ GC**, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π.
* –ú–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `GOGC` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `GOGC=100`):

  * `GOGC=200` ‚Äî —Ä–µ–∂–µ GC, –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏
  * `GOGC=20` ‚Äî —á–∞—Å—Ç–æ GC, –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏

---

## üß† –ß—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∏–∂–∏–º—ã–º (–∂–∏–≤—ã–º)?

* –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–π (–Ω–∞ —Å—Ç–µ–∫–µ)
* –û–±—ä–µ–∫—Ç—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Å—Å—ã–ª–∞—é—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
* –û–±—ä–µ–∫—Ç—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Å—Å—ã–ª–∞—é—Ç—Å—è –¥—Ä—É–≥–∏–µ –∂–∏–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ GC

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```go
var m runtime.MemStats
runtime.ReadMemStats(&m)
fmt.Println("NumGC:", m.NumGC)
```

–ò–ª–∏ `pprof`, `go tool trace`, `GODEBUG=gctrace=1`

---

## üî¨ –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ `GODEBUG=gctrace=1`

```bash
GODEBUG=gctrace=1 go run main.go
```

```
gc 1 @1.202s 6%: 0.006+0.88+0.003 ms clock, 0.03+0.22/0.71/0.13+0.01 ms cpu
```

–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞:

| –ß–∞—Å—Ç—å              | –ó–Ω–∞—á–µ–Ω–∏–µ                                         |
| ------------------ | ------------------------------------------------ |
| `gc 1 @1.202s`     | GC #1 –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ 1.2 —Å–µ–∫—É–Ω–¥—ã                  |
| `6%`               | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ 6% –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ GC             |
| `0.006+0.88+0.003` | –ü–∞—É–∑–∞ STW + mark + final pause (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö) |

---

## ‚úÖ –í—ã–≤–æ–¥

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å Go GC | –û–ø–∏—Å–∞–Ω–∏–µ                                                            |
| ----------------- | ------------------------------------------------------------------- |
| –ê–ª–≥–æ—Ä–∏—Ç–º          | Mark and Sweep                                                      |
| –ü–æ–≤–µ–¥–µ–Ω–∏–µ         | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π, stop-the-world —Ç–æ–ª—å–∫–æ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ |
| –°—Ç–∞—Ä—Ç             | –ü–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é –ø–æ—Ä–æ–≥–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏ (`GOGC`)                     |
| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞      | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—É–∑—ã, –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–∞–º—è—Ç—å—é      |
| –ú–æ–∂–Ω–æ –ª–∏ –≤–ª–∏—è—Ç—å   | –î–∞ ‚Äî —á–µ—Ä–µ–∑ `GOGC`, `MemStats`, `GODEBUG`                            |

---

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É –æ–±—ä—è—Å–Ω–∏—Ç—å **–≤–ª–∏—è–Ω–∏–µ GC –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**, –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å **–ø—Ä–∏–º–µ—Ä –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º GC**.

4) –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

``` go
package main

import (
	"fmt"
)

func mergeUnique(a, b []int) []int {
	seen := make(map[int]bool)
	var result []int

	for _, v := range a {
		if !seen[v] {
			result = append(result, v)
			seen[v] = true
		}
	}
	for _, v := range b {
		if !seen[v] {
			result = append(result, v)
			seen[v] = true
		}
	}
	return result
}

func main() {
	a := []int{1, 2, 3, 4}
	b := []int{3, 4, 5, 6}
	merged := mergeUnique(a, b)
	fmt.Println(merged) // [1 2 3 4 5 6]
}
```

5) –†–µ—à–µ–Ω–∏–µ ‚Äî –¥–≤–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è
``` go
func mergeSortedUnique(a, b []int) []int {
	i, j := 0, 0
	var result []int

	for i < len(a) && j < len(b) {
		if a[i] < b[j] {
			if len(result) == 0 || result[len(result)-1] != a[i] {
				result = append(result, a[i])
			}
			i++
		} else if a[i] > b[j] {
			if len(result) == 0 || result[len(result)-1] != b[j] {
				result = append(result, b[j])
			}
			j++
		} else { // a[i] == b[j]
			if len(result) == 0 || result[len(result)-1] != a[i] {
				result = append(result, a[i])
			}
			i++
			j++
		}
	}

	// –î–æ–±–∞–≤–∏–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
	for i < len(a) {
		if result[len(result)-1] != a[i] {
			result = append(result, a[i])
		}
		i++
	}

	for j < len(b) {
		if result[len(result)-1] != b[j] {
			result = append(result, b[j])
		}
		j++
	}

	return result
}
```

6) Merge

``` go
package main

import (
	"fmt"
	"sync"
)

func main() {
    chA := make(chan int)
    chB := make(chan int)
    chC := make(chan int)

    go func() {
        for i := 1; i <= 3; i++ {
            chA <- i
        }
        close(chA)
    }()
    go func() {
        for i := 11; i <= 13; i++ {
            chB <- i
        }
        close(chB)
    }()
    go func() {
        for i := 21; i <= 23; i++ {
            chC <- i
        }
        close(chC)
    }()

    // –°–ª–∏–≤–∞–µ–º –≤—Å—ë –≤ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª
    out := merge(chA, chB, chC)

    // –ß–∏—Ç–∞–µ–º –∏–∑ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
    for val := range out {
        fmt.Println(val)
    }

}

// –ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç merge N –∫–∞–Ω–∞–ª–æ–≤. 
// –í–µ—Å—å –≤—Ö–æ–¥–Ω–æ–π –ø–æ—Ç–æ–∫ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª.
func merge(cs ...<-chan int) <-chan int {
    out := make(chan int)
    wg := sync.WaitGroup{}
    for _, ch := range cs {
        wg.Add(1)
        go func(ch <-chan int) {
            defer wg.Done()
			for val := range ch {
				out <- val
			}
        }(ch)
    }
    go func() {
        wg.Wait()
        close(out)
    }()
    return out
}
```