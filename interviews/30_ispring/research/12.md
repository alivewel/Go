–ö–∞–∫–∏–µ –≤–∏–¥—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ë–î –∑–Ω–∞–µ—à—å?

---

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî **–≤–∏–¥—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –ë–î (database locks)** ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏. –ù–∏–∂–µ ‚Äî —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—è–º, –≤–∏–¥–∞–º –∏ –ø—Ä–∏–º–µ—Ä–∞–º.

---

## üîê –û—Å–Ω–æ–≤–Ω—ã–µ **–≤–∏–¥—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –ë–î**

### 1. üîÑ **–ü–æ —Ç–∏–ø—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (—á—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –¥—Ä—É–≥–∏–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º)**

| –¢–∏–ø                       | –ù–∞–∑–≤–∞–Ω–∏–µ                                  | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                  |
| ------------------------- | ----------------------------------------- | ----------------------------------------------------------- |
| üü© **Shared Lock (S)**    | –†–∞–∑—Ä–µ—à–∞–µ—Ç **—á—Ç–µ–Ω–∏–µ**, –Ω–æ –Ω–µ –∑–∞–ø–∏—Å—å –¥—Ä—É–≥–∏–º | –ù–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å, –Ω–æ –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å |
| üü• **Exclusive Lock (X)** | –ë–ª–æ–∫–∏—Ä—É–µ—Ç **–∏ —á—Ç–µ–Ω–∏–µ, –∏ –∑–∞–ø–∏—Å—å** –¥—Ä—É–≥–∏–º–∏  | –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –∏ –ø–∏—Å–∞—Ç—å                |

> ‚úÖ –ü—Ä–∏–º–µ—Ä (PostgreSQL):
> `SELECT ... FOR SHARE` ‚Äî shared lock
> `SELECT ... FOR UPDATE` ‚Äî exclusive lock

---

### 2. üìè **–ü–æ —É—Ä–æ–≤–Ω—é (granularity)**

| –£—Ä–æ–≤–µ–Ω—å               | –ü—Ä–∏–º–µ—Ä—ã                                           |
| --------------------- | ------------------------------------------------- |
| üîπ **Row-level**      | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã (`FOR UPDATE`) |
| üî∏ **Page-level**     | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü (—Ä–µ–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)            |
| üî∂ **Table-level**    | –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã (`LOCK TABLE`)          |
| üü• **Database-level** | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ–π –±–∞–∑—ã (–æ–±—ã—á–Ω–æ –∞–≤–∞—Ä–∏–π–Ω–∞—è)           |

---

### 3. ‚öôÔ∏è **–ü–æ –º–µ—Ö–∞–Ω–∏–∑–º—É/–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é**

| –¢–∏–ø                       | –û–ø–∏—Å–∞–Ω–∏–µ                                                                      |
| ------------------------- | ----------------------------------------------------------------------------- |
| ‚ùó **Pessimistic Lock**    | –Ø–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –î—É–º–∞–µ–º, —á—Ç–æ **–∫–æ–Ω—Ñ–ª–∏–∫—Ç —Ç–æ—á–Ω–æ –±—É–¥–µ—Ç**.   |
| ‚úÖ **Optimistic Lock**     | –ö–æ–Ω—Ñ–ª–∏–∫—Ç **–º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–µ–Ω**, –ø—Ä–æ–≤–µ—Ä—è–µ–º `version` –∏–ª–∏ `timestamp` –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º |
| üß† **Intent Locks**       | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –±–ª–æ–∫–∏ (—É–∫–∞–∑–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è), –Ω–∞–ø—Ä–∏–º–µ—Ä –≤ SQL Server / Oracle         |
| üîÅ **Deadlock Detection** | –ú–µ—Ö–∞–Ω–∏–∑–º –≤—ã—è–≤–ª–µ–Ω–∏—è –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –≤–∑–∞–∏–º–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫                           |

---

## üìò –ü—Ä–∏–º–µ—Ä—ã SQL-–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (PostgreSQL)

```sql
-- Shared lock (—á—Ç–µ–Ω–∏–µ)
SELECT * FROM users WHERE id = 1 FOR SHARE;

-- Exclusive lock (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏)
SELECT * FROM users WHERE id = 1 FOR UPDATE;

-- –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
LOCK TABLE users IN ACCESS EXCLUSIVE MODE;

-- Optimistic lock
UPDATE users SET version = version + 1 WHERE id = 1 AND version = 5;
```

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏

| –ü—Ä–æ–±–ª–µ–º–∞               | –ü—Ä–∏—á–∏–Ω–∞                                                              |
| ---------------------- | -------------------------------------------------------------------- |
| üîÅ **Deadlock**        | –í–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤                                         |
| ‚è≥ **Blocking**         | –û–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∂–¥—ë—Ç –¥—Ä—É–≥—É—é                                          |
| üîÑ **Phantom reads**   | –ù–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–µ—Å–ª–∏ –Ω–µ—Ç –Ω—É–∂–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏) |
| üßä **Lock contention** | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∑–∞ –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å—Ç—Ä–æ–∫—É –∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É         |

---

## ‚úÖ –í—ã–≤–æ–¥

> **–í–∏–¥—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** –¥–µ–ª—è—Ç—Å—è –ø–æ **—Ç–∏–ø—É –¥–æ—Å—Ç—É–ø–∞ (S/X)**, **—É—Ä–æ–≤–Ω—é –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (—Å—Ç—Ä–æ–∫–∞, —Ç–∞–±–ª–∏—Ü–∞, –±–∞–∑–∞)** –∏ **—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è/–ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è)**.
> –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∏—Ö –≤–∞–∂–Ω–æ –¥–ª—è **—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö**, **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏** –∏ **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**.

---

–•–æ—á–µ—à—å ‚Äî –ø–æ–∫–∞–∂—É, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –¥–µ–¥–ª–æ–∫–æ–≤ –∏–ª–∏ —Å—Ä–∞–≤–Ω—é –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ PostgreSQL vs MySQL.
