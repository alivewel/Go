–∫–∞–∫ –ø–æ—Å—Ç–≥—Ä–µ—Å —Å–æ–±–∏—Ä–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –∫–∞–∫ –ø–æ—Ç–æ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ —É—á–∏—Ç—ã–≤–∞–µ—Ç –µ–µ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞?

–û—Ç–ª–∏—á–Ω—ã–π –∏ –≥–ª—É–±–æ–∫–∏–π –≤–æ–ø—Ä–æ—Å. PostgreSQL **—Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∏–ª–∏ –≤—Ä—É—á–Ω—É—é (—á–µ—Ä–µ–∑ `ANALYZE`) –∏ **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ—ë –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –ø–ª–∞–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞**, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –Ω–∞–∏–ª—É—á—à—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é ‚Äî `Seq Scan`, `Index Scan`, `Bitmap Index Scan`, `Nested Loop`, `Hash Join` –∏ —Ç. –¥.

–†–∞–∑–±–µ—Ä—ë–º—Å—è –ø–æ —à–∞–≥–∞–º:

---

## üß† 1. **–ö–∞–∫ PostgreSQL —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É**

### ‚úÖ –ö–æ–≥–¥–∞ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ **–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π** (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω `autovacuum`).

* –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã:

  ```sql
  ANALYZE table_name;
  ```

* –ò–ª–∏ –≤–º–µ—Å—Ç–µ —Å:

  ```sql
  VACUUM ANALYZE;
  ```

---

### üóÇ –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?

PostgreSQL —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ **–∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ** –≤ —Ç–∞–±–ª–∏—Ü–µ, –≤–∫–ª—é—á–∞—è:

| –ü–∞—Ä–∞–º–µ—Ç—Ä            | –ß—Ç–æ –∑–Ω–∞—á–∏—Ç                                    |
| ------------------- | --------------------------------------------- |
| `n_distinct`        | –û—Ü–µ–Ω–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ **—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π**     |
| `null_frac`         | –î–æ–ª—è **NULL** –∑–Ω–∞—á–µ–Ω–∏–π                        |
| `most_common_vals`  | –ß–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –∑–Ω–∞—á–µ–Ω–∏—è                  |
| `most_common_freqs` | –ß–∞—Å—Ç–æ—Ç—ã —ç—Ç–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π                         |
| `histogram_bounds`  | –ì—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π            |
| `correlation`       | –ù–∞—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (–æ—Ç -1 –¥–æ 1) |

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–∂–Ω–æ —Ç–∞–∫:

```sql
SELECT * FROM pg_stats WHERE tablename = 'your_table';
```

---

## üßÆ 2. **–ö–∞–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É**

–ö–æ–≥–¥–∞ —Ç—ã –≤—ã–ø–æ–ª–Ω—è–µ—à—å –∑–∞–ø—Ä–æ—Å, PostgreSQL **–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–ª–∞–Ω—ã** –∏ –≤—ã–±–∏—Ä–∞–µ—Ç **—Å–∞–º—ã–π –¥–µ—à—ë–≤—ã–π –ø–æ cost-–º–æ–¥–µ–ª–∏**.

–û–Ω –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç:

| –û—Ü–µ–Ω–∫–∞                         | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç                                                                                   |
| ------------------------------ | -------------------------------------------------------------------------------------------- |
| –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ | –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É—Å–ª–æ–≤–∏–π `WHERE` –Ω–∞ –æ—Å–Ω–æ–≤–µ `n_distinct`, `histogram_bounds`, `most_common_vals` |
| –°—Ç–æ–∏–º–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã       | –û—Ü–µ–Ω–∏–≤–∞–µ—Ç, –±—ã—Å—Ç—Ä–µ–µ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å `Seq Scan`                             |
| –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è        | –ï—Å—Ç—å –ª–∏ —Å–º—ã—Å–ª —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ (`correlation`)                    |
| –í—ã–±–æ—Ä–∫–∞ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É           | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≥—Ä–∞–Ω–∏—Ü, –Ω–∞–ø—Ä–∏–º–µ—Ä `WHERE age BETWEEN 20 AND 30`             |

---

### üìå –ü—Ä–∏–º–µ—Ä: –ø–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞

```sql
EXPLAIN ANALYZE
SELECT * FROM users WHERE age BETWEEN 20 AND 30;
```

PostgreSQL –ø–æ—Å–º–æ—Ç—Ä–∏—Ç:

* –°–∫–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —É `age`
* –ö–∞–∫ –æ–Ω–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã (`histogram_bounds`)
* –ß–∞—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (`most_common_vals`)
* –û—Ü–µ–Ω–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ ‚Üí –≤—ã–±–µ—Ä–µ—Ç **`Index Scan`** –∏–ª–∏ **`Seq Scan`** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–π —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

---

## üîß –ö–∞–∫ **—É–ø—Ä–∞–≤–ª—è—Ç—å** —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π?

### ‚ûï –ü–æ–≤—ã—Å–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å:

```sql
ALTER TABLE your_table ALTER COLUMN your_column SET STATISTICS 1000;
ANALYZE your_table;
```

(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî 100)

---

## üß™ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è):

```sql
CREATE TABLE demo (id SERIAL, category TEXT);
INSERT INTO demo (category) SELECT
  CASE WHEN random() < 0.9 THEN 'A' ELSE 'B' END
FROM generate_series(1, 1000000);

CREATE INDEX ON demo(category);
ANALYZE demo;

-- –ó–∞–ø—Ä–æ—Å —Å –≤—ã—Å–æ–∫–æ–π —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
EXPLAIN ANALYZE SELECT * FROM demo WHERE category = 'B';
```

–¢—ã —É–≤–∏–¥–∏—à—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ `Index Scan` ‚Äî –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ—Ü–µ–Ω–∏—Ç, —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π 'B'.

---

## üìö –í—ã–≤–æ–¥:

| –í–æ–ø—Ä–æ—Å                                                | –û—Ç–≤–µ—Ç                                                         |
| ----------------------------------------------------- | ------------------------------------------------------------- |
| –°–º–æ—Ç—Ä–∏—Ç –ª–∏ PostgreSQL –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏? | ‚úÖ –î–∞                                                          |
| –ö–∞–∫ –µ—ë —Å–æ–±—Ä–∞—Ç—å?                                       | `ANALYZE` –∏–ª–∏ `VACUUM ANALYZE`                                |
| –ì–¥–µ –æ–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è?                                     | –í `pg_stats` (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) –∏ `pg_statistic` (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è) |
| –í–ª–∏—è–µ—Ç –ª–∏ –Ω–∞ –≤—ã–±–æ—Ä –º–µ–∂–¥—É Index Scan / Seq Scan?       | ‚úÖ –û—á–µ–Ω—å —Å–∏–ª—å–Ω–æ                                                |
| –ú–æ–∂–Ω–æ –ª–∏ –Ω–∞ —ç—Ç–æ –ø–æ–≤–ª–∏—è—Ç—å?                             | ‚úÖ –ß–µ—Ä–µ–∑ `SET STATISTICS` –∏ `ANALYZE`                          |

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—è–µ—Ç –ø–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞.
