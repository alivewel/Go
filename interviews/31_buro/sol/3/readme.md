–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî —Å–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–µ–º —Ä–µ–≤—å—é –∫–æ–¥–∞, –∞ –∑–∞—Ç–µ–º —Ä–∞–∑–±–µ—Ä—ë–º—Å—è, –∫–∞–∫ **—Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É** –∏ **–∫–∞–∫–∏–µ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—ã: –∞—Ç–æ–º–∏–∫–∏, –º—å—é—Ç–µ–∫—Å—ã, RWMutex ‚Äî –∏ –∫–æ–≥–¥–∞ —á—Ç–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å.**

---

### üîç –ß—Ç–æ **–Ω–µ —Ç–∞–∫** —Å –∫–æ–¥–æ–º:

```go
var counter int
...
go func() {
    counter++
}
```

* –û–ø–µ—Ä–∞—Ü–∏—è `counter++` **–Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ–π**. –û–Ω–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:

  1. –ß—Ç–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è `counter`
  2. –ü—Ä–∏–±–∞–≤–ª–µ–Ω–∏—è 1
  3. –ó–∞–ø–∏—Å–∏ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ `counter`

* –¢–∞–∫ –∫–∞–∫ `counter` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ **–º–Ω–æ–≥–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö**, –≤–æ–∑–Ω–∏–∫–∞–µ—Ç **–≥–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö (data race)**.

* –ò—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `counter` **–Ω–µ –±—É–¥–µ—Ç —Ä–∞–≤–Ω–æ 1000** ‚Äî –∫–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

---

### ‚úÖ –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å ‚Äî —Ç—Ä–∏ —Å–ø–æ—Å–æ–±–∞

---

#### ‚úÖ 1. –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `sync.Mutex`:

```go
var counter int
var mu sync.Mutex
...
go func() {
    defer wg.Done()
    mu.Lock()
    counter++
    mu.Unlock()
}()
```

üî∏ **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

* –ö–æ–≥–¥–∞ —Ç–µ–±–µ –Ω—É–∂–Ω–æ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø** –∫ —Ä–µ—Å—É—Ä—Å—É
* –ü—Ä–æ—Å—Ç–æ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

---

#### ‚úÖ 2. –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `sync/atomic`:

```go
import "sync/atomic"

var counter int64
...
go func() {
    defer wg.Done()
    atomic.AddInt64(&counter, 1)
}()
```

üî∏ **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

* –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏, —Ñ–ª–∞–≥–∏, —Å—á—ë—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
* –ù—É–∂–Ω–æ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ–µ** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –æ—Ç `mutex`

---

#### ‚úÖ 3. –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `sync.RWMutex`:

`RWMutex` ‚Äî —ç—Ç–æ **—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º—å—é—Ç–µ–∫—Å**, –¥–∞—é—â–∏–π:

* **RLock** ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –º–æ–≥—É—Ç **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—Ç—å**
* **Lock** ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å (–±–ª–æ–∫–∏—Ä—É–µ—Ç –∏ —á—Ç–µ–Ω–∏–µ, –∏ –∑–∞–ø–∏—Å—å)

‚ö†Ô∏è –í **—ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –Ω–µ –Ω—É–∂–µ–Ω `RWMutex`**, —Ç–∞–∫ –∫–∞–∫ `counter++` ‚Äî —ç—Ç–æ **–∑–∞–ø–∏—Å—å**. –û–Ω –Ω—É–∂–µ–Ω, –µ—Å–ª–∏:

* –£ —Ç–µ–±—è –º–Ω–æ–≥–æ —á—Ç–µ–Ω–∏–π –∏ –º–∞–ª–æ –∑–∞–ø–∏—Å–µ–π
* –ù–∞–ø—Ä–∏–º–µ—Ä, –∫—ç—à –∏–ª–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

---

### üß† –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚Äî —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–æ–¥—Ö–æ–¥         | –ü—Ä–∏–º–µ—Ä                     | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞                           | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏                                       | –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å                |
| -------------- | -------------------------- | -------------------------------------- | ------------------------------------------------ | ------------------------------ |
| `sync.Mutex`   | `mu.Lock()`                | –ü—Ä–æ—Å—Ç–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ                      | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –∞—Ç–æ–º–∏–∫–æ–≤                               | –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π |
| `sync.RWMutex` | `rw.RLock()` / `rw.Lock()` | –ë—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ, –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å       | –°–ª–æ–∂–Ω–µ–µ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏, –º–æ–∂–µ—Ç ¬´–∑–∞–ø–µ—Ä–µ—Ç—å¬ª —á—Ç–µ–Ω–∏–µ | –ö–æ–≥–¥–∞ 90% –æ–ø–µ—Ä–∞—Ü–∏–π ‚Äî —á—Ç–µ–Ω–∏–µ    |
| `atomic`       | `atomic.AddInt64()`        | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ, –Ω–∏–∑–∫–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã | –¢–æ–ª—å–∫–æ –¥–ª—è **–ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤** (`int`, `bool`)        | –°—á—ë—Ç—á–∏–∫–∏, —Ñ–ª–∞–≥–∏, –º–µ—Ç—Ä–∏–∫–∏       |

---

### üß™ –ß—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç—å/–æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏:

* **–ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `counter++` –≤ –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö?**
  ‚Üí –ü–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –Ω–µ –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è. –í–æ–∑–Ω–∏–∫–∞–µ—Ç data race.

* **–ö–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?**
  ‚Üí –° –ø–æ–º–æ—â—å—é `Mutex`, `atomic`, `channel`, `sync.Map` ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–∞—á–∏.

* **–ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å: Mutex –∏–ª–∏ atomic?**
  ‚Üí –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—á—ë—Ç—á–∏–∫ ‚Üí `atomic`.
  ‚Üí –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—à—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ ‚Üí `Mutex`.

* **–ê –µ—Å–ª–∏ —á—Ç–µ–Ω–∏–π –º–Ω–æ–≥–æ, –∞ –∑–∞–ø–∏—Å–∏ —Ä–µ–¥–∫–∏–µ?**
  ‚Üí –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `RWMutex`: `RLock()` –¥–ª—è —á—Ç–µ–Ω–∏—è, `Lock()` –¥–ª—è –∑–∞–ø–∏—Å–∏.

---

–•–æ—á–µ—à—å, —è –ø—Ä–∏–≤–µ–¥—É –±–µ–Ω—á–º–∞—Ä–∫ `Mutex vs Atomic` –¥–ª—è —Å—á—ë—Ç—á–∏–∫–æ–≤, —á—Ç–æ–±—ã —Å—Ä–∞–≤–Ω–∏—Ç—å –∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?
